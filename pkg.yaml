name: u-boot
dependencies:
  - name: base
  - name: musl
  - name: ca-certificates
finalize:
  - from: /rootfs
    to: /
variant: scratch
shell: /toolchain/bin/bash
steps:
  - sources:
      - url: https://github.com/u-boot/u-boot/archive/v2019.04.tar.gz
        destination: u-boot.tar.gz
        sha256: 2ebdcc385e0d84c04a4b8a7f5a2baa7cabc5b224ff113fad556917df2c5600e8
        sha512: afcc44bfe3161c9b4c9d785628a8d30940645baa295909d4097e6bf27680998532eb9dd81a070cf8d288f5dff2a3e7a77a38acce13de9f5084babd423657f2ae

    prepare: |
      tar -xzvf u-boot.tar.gz --strip-components=1

      mkdir /bin
      ln -sv /toolchain/bin/bash /bin/bash
      ln -sv /toolchain/bin/bash /bin/sh
      cp -R /toolchain/lib/gcc /lib
      cp -R /toolchain/lib/libgcc* /lib

      make libretech_all_h3_cc_h5_defconfig

    build: |
      make -j $(nproc)

    install: |
      mkdir /rootfs
      cp u-boot-sunxi-with-spl.bin /rootfs
